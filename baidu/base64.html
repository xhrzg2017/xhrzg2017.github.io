<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>清除页</title>
</head>

<body>
<input type="file" name="img">
<br>
<input type="button" name="clearMyBG" value="清除我的设置">
<script>
// 尝试读取localStorage中存储的背景图片，如果有就设置
var myBGStorage = localStorage.getItem("myBG");
if (myBGStorage) {
 document.body.style.backgroundImage="url("+myBGStorage+")";
}
 
// 将选择的文件储存在localStorage里
document.querySelector("input[name=img]").addEventListener("change",function(){
    if (!/image\/\w/.test(this.files[0].type)) {
        alert("请确保文件为图像类型");
        return false;
    }
    setMyBG(this.files[0]);
})
 
//清除存储的背景图片
document.querySelector("input[name=clearMyBG]").addEventListener("click",function(){
    localStorage.removeItem("myBG");
    alert("设置已清除");
    location.reload();
})
 
//转换、存储和设置背景图片
function setMyBG (imgfile){
    var fileReader = new FileReader();
    fileReader.readAsDataURL(imgfile);
    fileReader.onload=function(){
        var result = this.result;
        document.body.style.backgroundImage="url("+result+")";
        try {
            localStorage.setItem("myBG", result);
        }catch (e) {
            console.log("Storage failed: " + e);
        }
    }
}
</script>
</body>
</html>
